# rql-java

[![Release](https://jitpack.io/v/chenyuejie/rql-java.svg)](https://jitpack.io/#chenyuejie/rql-java)

**RQL** 是个类似于SQL的Web资源查询语言, 使用RQL可以通过一条语句, 并行地查询多个Web资源, 并且返回过滤, 转换或者合并的结果. 你可以把RQL当做一个简单, 高效的http client, 也可以用它来构建 [BFF](http://samnewman.io/patterns/architectural/bff/) 应用, 简化你的开发.

**RQL**(Resource Query Language) is a web resources query syntax similar to SQL. With RQL, you can query multiple Http resources parallel, and return filtered, transformed, aggregated response in a single query statement.

It would be very easily to build [BFF](http://samnewman.io/patterns/architectural/bff/) for microservices with RQL.

## Syntax
You can view Syntax Diagrams [here](https://chenyuejie.github.io/RQL/syntax/) (generated by [https://github.com/bkiers/rrd-antlr4](https://github.com/bkiers/rrd-antlr4)) ([what's Syntax Diagram](https://en.wikipedia.org/wiki/Syntax_diagram))

The antlr4 grammar is [here](https://github.com/chenyuejie/rql-java/blob/master/src/main/antlr4/rql/antlr/RQL.g4)



## Examples
Statement Examples:

#### Plain Query

| Statement                                                          | Response Entity             |
|--------------------------------------------------------------------|-----------------------------|
| Select * from <GET http://127.0.0.1:8080/simple-map &gt;        | {"a": "a", "b": "b"}       |
| Select \* from &lt;GET http://127.0.0.1:8080/simple-map &gt;;<br>Select \* from &lt;GET http://127.0.0.1:8080/simple-list &gt;        | [{"a": "a", "b": "b"}  <br>, [{"a": "a1", "b": "b1"}, {"a": "a2", "b": "b2"}]]     |
| Select a from <GET http://127.0.0.1:8080/simple-map &gt;        | {"a": "a"}                  |
| Select a as b from <GET http://127.0.0.1:8080/simple-map &gt;   | {"b": "a"}                  |
| Resource a: &lt;GET http://127.0.0.1:8080/simple-map &gt; <br>Select * from a  | {"a": "a", "b": "b"}  |
| Parameter id: 'id' <br>Select * from <GET http://127.0.0.1:8080/name?id=:id &gt; | {"id": "id", "name": "id's Name"}  |
| Select * from <GET http://127.0.0.1:8080/name data id='id' &gt; | {"id": "id", "name": "id's Name"}  |
| Parameter data: '{"id":"1", "name":a}' <br> Select * from <POST http://127.0.0.1:8080/records :data&gt; | {"row":1} |
#### Union
| Statement                                                          | Response Entity             |
|--------------------------------------------------------------------|-----------------------------|
| select * from &lt;GET http://127.0.0.1:8080/simple-map &gt; as r1<br>union select a from &lt;GET http://127.0.0.1:8080/simple-map &gt; as r2<br>union select a from &lt;GET http://127.0.0.1:8080/simple-map &gt;        | {"r1": {"a": "a", "b": "b"}, "r2": {"a": "a"}, "a":"a"  }       |

#### Join
| Statement                                                          | Response Entity             |
|--------------------------------------------------------------------|-----------------------------|
| select a.*, b.name from &lt;GET http://127.0.0.1:8080/simple-list &gt; as a<br>join &lt;GET http://127.0.0.1:8080/name &gt; as b on b.id=a.a <br> (1+N queries, N is in parallel)      | [{"a": "a1", "b": "b1", "name": "a1's Name"}, {"a": "a2", "b": "b2", "name": "as's Name"}]       |
| select a.*, b.name from &lt;GET http://127.0.0.1:8080/simple-list &gt; as a<br>join &lt;GET http://127.0.0.1:8080/names &gt; as b on b.id in a.a <br> (1+1 queries)        | [{"a": "a1", "b": "b1", "name": "a1's Name"}, {"a": "a2", "b": "b2", "name": "as's Name"}]       |

#### Async Invoke
| Statement                                                          | Response Entity             |
|--------------------------------------------------------------------|-----------------------------|
| Send <POST http://127.0.0.1:8080/records &gt;                       | null       |


You can get more examples from the JUnit test.

## Java Client

Maven pom.xml

    <repositories>
      <repository>
        <id>jitpack.io</id>
        <url>https://jitpack.io</url>
      </repository>
    </repositories>

    <dependency>
      <groupId>com.github.chenyuejie</groupId>
      <artifactId>rql-java</artifactId>
      <version>-SNAPSHOT</version>
    </dependency>

Code snippet

    String rql = "select id, name from <GET http://127.0.0.1:8080/simple-object>";
    Statement stmt = RQLClient.getDefault().createStatement(rql);
    RQLResponse resp = stmt.execute(rql);
    Domain domain = resp.getEntity(Domain.class);
    Assert.assertEquals(1, domain.id);
    Assert.assertEquals("root", domain.name);
